var N=1024*1024;function A(I,S,E){let T,n=0;return new ReadableStream({async start(){T=await I.open(S,1,2,void 0,{signal:E})},async pull(R){if(E?.aborted){R.close();return}try{let _=await I.read(T,n,N,{signal:E});n+=N,_.byteLength>0?R.enqueue(_):R.close()}catch{R.close()}},async cancel(){I.close(T)}})}async function r(I){let S=I.getReader(),E=[],T=0;for(;;){let{done:R,value:_}=await S.read();if(R)break;_&&(E.push(_),T+=_.length)}let n=new Uint8Array(T),O=0;for(let R of E)n.set(R,O),O+=R.length;return n}async function L(I,S){let E=A(faraday.fs,I,S?.signal);return r(E)}var C=document.getElementById("root");function u(I){switch(I.split(".").at(-1)){case"apng":return"image/apng";case"avif":return"image/avif";case"gif":return"image/gif";case"jpg":case"jpeg":case"jfif":case"pjpeg":case"pjp":return"image/jpeg";case"png":return"image/png";case"svg":return"image/svg+xml";case"webp":return"image/webp";case"bmp":return"image/bmp";case"ico":return"image/x-icon";default:return}}var e,D=async I=>{let S=await L(I),E=document.createElement("img");E.style.width="100%",E.style.height="100%",E.style.objectFit="contain",E.style.position="absolute",E.style.top="50%",E.style.left="50%",E.style.transform="translate(-50%, -50%)";let T=`color-mix(in srgb, transparent, ${faraday.theme.colors["panel.foreground"]} 5%)`;E.style.backgroundImage=`linear-gradient(45deg, ${T} 25%, transparent 25%), linear-gradient(-45deg, ${T} 25%, transparent 25%), linear-gradient(45deg, transparent 75%, ${T} 75%), linear-gradient(-45deg, transparent 75%, ${T} 75%)`,E.style.backgroundSize="20px 20px",E.style.backgroundPosition="0 0, 0 10px, 10px -10px, -10px 0px",e=URL.createObjectURL(new Blob([S.buffer],{type:u(I)})),E.src=e,E.onload=()=>{C.innerHTML="",C.appendChild(E)},E.onerror=()=>{C.innerHTML="Cannot load the image."}};function c(){console.info("Image Viewer Activated"),faraday.events.on("activefilechange",D),faraday.activefile&&D(faraday.activefile)}function d(){console.info("Image Viewer Deactivated"),faraday.events.off("activefilechange",D),C.innerHTML="",URL.revokeObjectURL(e)}export{c as activate,d as deactivate};
